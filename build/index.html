<html>
	<!-- <script type="text/javascript" src="//ajax.googleapis.com/ajax/libs/jquery/3.4.0/jquery.min.js"></script> -->
	<script type="text/javascript" src="/BBCore.min.js"></script>
	<!-- <script type="text/javascript" src="https://static.bombbomb.com/js/BBCore.min.js"></script> -->
	<body>
		<!-- <div class="overlay"><h2 style="color:white">HACKED</h2></div> -->
		<div id='recorder'>
		</div>
		<div>
			<label>
				Message:
				<br/>
				<textarea id='message'></textarea>
			</label>
			<br/>
			<label>
				Recipient:
				<br/>
				<input id='email'/>
			</label>
			<br/>
			<input type="button" onclick="saveVideo()" value="Save video to library"/>
			<input type="button" onclick="sendVideo()" value="Send email"/>
			<!-- <input type="button" onclick="registerWithBixel()" value="Register Bixel"/> -->
			<input type="button" onclick="BadUnload()" value="Bad Unload"/>
			<input type="button" onclick="Reload()" value="Reload"/>
			<input type="button" onclick="destroyRecorder()" value="Destroy Recorder"/>
			<!-- <a href="https://desktop.bombbomb.io/launch/35fc2044-cb1e-4402-8d27-0e329cd81205/1dbda6df-89e6-424e-8605-b4005b58fb46/0/0">launch screen recorder</a> -->
		</div>
	</body>
	<script type="text/javascript">
		const REQUEST_URL = 'https://dev.app.bombbomb.com';
		const API_URL = 'https://dev.api.bombbomb.com';
		const API_KEY = 'd4cbd485-c2fa-1bac-ce94-8a58fa25dbad';
		const ACCESS_TOKEN = 'fake'
    console.log('starting core')
		var core = startCore(false);
    console.log('all set')
		var vidInfo = null;


		function startCore(withToken) {
			if(!withToken) {
				return new BBCore({
					accessToken: API_KEY,
					apiServer:REQUEST_URL,
					onerror: onFail
				});
			} else {
				return new BBCore({
					accessToken: ACCESS_TOKEN,
					apiServer:REQUEST_URL,
					onerror: onFail
				});
			}
		}

		function onFail(error) {
			console.error(error);
			console.error('not good enough');
		}

		function registerWithBixel() {
			const token = getAccessTokenFromApiKey()
			return getAccessTokenFromApiKey(API_KEY).then(data => console.log(data));
		}

		function getAccessTokenFromApiKey(apiKey) {
			const url = `${API_URL}/v2/accounts`
			return fetch(url).then(response => response.json());
		}

		window.addEventListener('message', function(event) {
			if (~event.origin.indexOf('app.bombbomb.com')) {
				console.warn(`EVENT:${event.data.action}`);
				if (event.data.action == 'onScreenRecordStart') {
					// DoYourThing();
				}
			}
		});

// setTimeout(() => {
		launchRecorder();
// }, 1000)

		function saveVideo() {
			console.log('saving video...');
			core.saveRecordedVideo('testVideo', vidInfo.videoId, vidInfo.filename,
				function (data) {
					alert('Your video has been saved!', data);
					console.log(data);
				}
			);
		}

		function BadUnload() {
			const element = document.getElementById('recorder');
			element.innerHTML = '';
		}

		function launchRecorder() {
			core.startVideoRecorder({ target: '#recorder', width: 800, height: 540}, function(info) {
				console.log('ready!', info);
				console.log('VID_INFO:', info);
				vidInfo = info;
			});
		}

		function Reload() {
			console.log("no guid refresh!");
			launchRecorder();
		}

		function sendVideo(videoId) {
			const email = document.getElementById('email').value
			const message = document.getElementById('message').value
			console.log("sending", email, message);
			core.videoQuickSend({
				subject: 'SimpleBBCore Test',
				video_id: videoId,
				email_addresses: email,
				mobile_message: message

			}, function (data) {
				alert("You've sent a video! " + data.info);
			});
		}

		function destroyRecorder() {
			core.destroyVideoRecorder();
			restoreContainer();
		}

		function restoreContainer() {
			const element = document.createElement('div');
			element.id = 'recorder';
			document.body.insertBefore(element, document.body.firstChild);
		}
	</script>
</html>
